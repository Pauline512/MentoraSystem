{% extends 'mentorship/base.html' %}

{% block title %}My Notifications{% endblock %}

{% block content %}
<div class="container">
    <h1>My Notifications</h1>

    <div class="notification-category">
        <h2>Request Notifications</h2>
        {% if request_notifications %}
            {% for notification in request_notifications %}
                <a href="{% url 'communication:index' %}" class="notification-item {% if not notification.is_read %}unread{% endif %}">
                    <div class="icon">
                        {% if notification.notification_type == 'NEW_REQUEST' %}
                            <i class="fas fa-user-plus"></i>
                        {% elif notification.notification_type == 'REQUEST_ACCEPTED' %}
                            <i class="fas fa-check-circle"></i>
                        {% elif notification.notification_type == 'REQUEST_REJECTED' %}
                            <i class="fas fa-times-circle"></i>
                        {% else %}
                            <i class="fas fa-bell"></i>
                        {% endif %}
                    </div>
                    <div class="content">
                        <p>{{ notification.message }}</p>
                        {% if notification.related_request %}
                            {# Link to relevant detail page based on role #}
                            {% if is_mentor %}
                                <small><a href="{% url 'mentor_detail' pk=notification.related_request.mentor.pk %}">View related mentor: {{ notification.related_request.mentor.user.username }}</a></small>
                            {% elif is_mentee %}
                                {# Mentees can view their sent request's details or the mentor's profile #}
                                <small><a href="{% url 'mentor_detail' pk=notification.related_request.mentor.pk %}">View mentor: {{ notification.related_request.mentor.user.username }}</a></small>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="timestamp">
                        {{ notification.created_at|date:"M d, Y H:i" }}
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p class="no-notifications">No request notifications at this time.</p>
        {% endif %}
    </div>

    <div class="notification-category">
        <h2>Message Notifications</h2>
        {% if message_notifications %}
            {% for notification in message_notifications %}
                <a href="{% url 'mark_notification_read_and_redirect' notification_pk=notification.pk %}" class="notification-item {% if not notification.is_read %}unread{% endif %}">
                    <div class="icon">
                        <i class="fas fa-envelope"></i> {# Icon for messages #}
                    </div>
                    <div class="content">
                        <p>{{ notification.message }}</p>
                        {% if notification.related_request %}
                            {# Link to relevant detail page based on role #}
                            {% if is_mentor %}
                                <small><a href="{% url 'mentor_detail' pk=notification.related_request.mentor.pk %}">View related mentor: {{ notification.related_request.mentor.user.username }}</a></small>
                            {% elif is_mentee %}
                                {# Mentees can view their sent request's details or the mentor's profile #}
                                <small><a href="{% url 'mentor_detail' pk=notification.related_request.mentor.pk %}">View mentor: {{ notification.related_request.mentor.user.username }}</a></small>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="timestamp">
                        {{ notification.created_at|date:"M d, Y H:i" }}
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p class="no-notifications">No message notifications at this time.</p>
        {% endif %}
    </div>
</div>

<style>
    .container {
        background-color: white;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 30px;
        max-width: 800px;
        margin: 30px auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    h1 {
        color: #007bff; text-align: center; margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 10px; 
    }
    .notification-category {
        margin-bottom: 30px;
    }
    .notification-category h2 {
        color: #333;
        margin-bottom: 15px;
        border-bottom: 1px solid #f0f0f0;
        padding-bottom: 5px;
    }
    .notification-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        background-color: #fefefe;
        display: flex;
        align-items: center;
        text-decoration: none; /* Remove underline from link */
        color: inherit; /* Inherit text color */
    }
    .notification-item.unread {
        background-color: #e6f7ff; /* Light blue for unread */
        border-color: #91d5ff;
        font-weight: bold;
    }
    .notification-item .icon {
        font-size: 1.5em;
        margin-right: 15px;
        color: #007bff;
    }
    .notification-item.unread .icon {
        color: #0056b3;
    }
    .notification-item .content {
        flex-grow: 1;
    }
    .notification-item .timestamp {
        font-size: 0.85em;
        color: #888;
        margin-left: 20px;
        white-space: nowrap; /* Prevent wrapping */
    }
    .no-notifications {
        text-align: center;
        color: #6c757d;
        padding: 20px;
        border: 1px dashed #ced4da;
        border-radius: 8px;
    }
    .messages {
        list-style-type: none; padding: 0; margin-bottom: 20px;
    }
    .messages li {
        padding: 10px; border-radius: 4px; margin-bottom: 10px;
    }
    .messages .success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
    .messages .error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
    .messages .info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }
</style>
{% endblock %}